/*-- scss:rules --*/

// Active pill tab: white text on coloured background
.nav-pills .nav-link.active {
  color: #fff !important;
}


// TOC vs margin content overlap fix.
// Quarto sets .column-margin { z-index: 998 }. The sidebar needs a higher
// z-index so the TOC paints above margin content, but stays transparent so
// margin images/notes remain visible below the TOC area.
#quarto-margin-sidebar {
  z-index: 999 !important;
  background: transparent !important;
}

nav#TOC {
  background-color: var(--bs-body-bg, #fff);
  padding-bottom: 1em;
}

// Hide figure-generating code entirely (code-fold blocks)
details.code-fold {
  display: none;
}

// ---- Collapse/expand for long code blocks ----

// Collapsed state: show first ~10 lines with gradient fade
div.sourceCode.code-collapsed {
  max-height: 16em;
  overflow: hidden;
  position: relative;

  &::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 3em;
    background: linear-gradient(transparent, var(--bs-body-bg, #fff));
    pointer-events: none;
  }
}

// Expanded state: remove constraints
div.sourceCode.code-expanded {
  max-height: none;
  overflow: visible;

  &::after {
    display: none;
  }
}

// Expand/collapse toggle button
.code-expand-btn {
  display: block;
  width: 100%;
  padding: 0.3em 0;
  border: none;
  background: var(--bs-light, #f8f9fa);
  border-top: 1px solid var(--bs-border-color, #dee2e6);
  color: var(--bs-secondary, #6c757d);
  font-size: 0.8em;
  cursor: pointer;
  text-align: center;
  border-radius: 0 0 0.375rem 0.375rem;

  &:hover {
    background: var(--bs-gray-200, #e9ecef);
    color: var(--bs-body-color, #212529);
  }
}

// ---- Pyodide editor collapse (code is optional for learning) ----

// Collapsed pyodide editor: limit height with gradient fade
.qpyodide-editor.code-collapsed {
  max-height: 16em;
  overflow: hidden;
  position: relative;

  &::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 3em;
    background: linear-gradient(transparent, var(--bs-body-bg, #fff));
    pointer-events: none;
    z-index: 10;
  }
}

// Expanded pyodide editor
.qpyodide-editor.code-expanded {
  max-height: none;
  overflow: visible;

  &::after {
    display: none;
  }
}

// ---- Dark mode toggle: sun/moon icons + circular button ----
// Quarto's default is a toggle-slider icon; override with moon (light) / sun (dark).
// The toggle lives inside .sidebar-navigation in book projects.
.quarto-color-scheme-toggle.quarto-navigation-tool {
  border: 1px solid rgba(42, 157, 143, 0.4);
  border-radius: 50%;
  transition: all 0.2s ease;
}
.quarto-color-scheme-toggle.quarto-navigation-tool:hover {
  border-color: #2A9D8F;
  background-color: rgba(42, 157, 143, 0.1);
}
// Light mode: show moon icon (click to go dark)
.sidebar-navigation .quarto-color-scheme-toggle:not(.alternate) .bi::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="%231D3557" viewBox="0 0 16 16"><path d="M6 .278a.77.77 0 0 1 .08.858 7.2 7.2 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277q.792-.001 1.533-.16a.79.79 0 0 1 .81.316.73.73 0 0 1-.031.893A8.35 8.35 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.75.75 0 0 1 6 .278"/><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.73 1.73 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.73 1.73 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.73 1.73 0 0 0 1.097-1.097z"/></svg>') !important;
}
// Dark mode: show sun icon (click to go light)
.sidebar-navigation .quarto-color-scheme-toggle.alternate .bi::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="%23dee2e6" viewBox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8M8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0M3.5 3a.5.5 0 0 1 .354.146l1.414 1.415a.5.5 0 1 1-.707.707L3.146 3.854A.5.5 0 0 1 3.5 3M2 8a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2A.5.5 0 0 1 2 8m2.854 3.44a.5.5 0 0 1 .707 0l1.414 1.413a.5.5 0 0 1-.707.707L4.854 12.146a.5.5 0 0 1 0-.707M8 16a.5.5 0 0 1-.5-.5v-2a.5.5 0 0 1 1 0v2A.5.5 0 0 1 8 16m3.44-2.854a.5.5 0 0 1 0-.707l1.413-1.414a.5.5 0 1 1 .707.707l-1.414 1.414a.5.5 0 0 1-.707 0M14 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 14 8m-2.854-3.44a.5.5 0 0 1-.707 0L9.025 3.146a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707"/></svg>') !important;
}

// ---- Dark mode: invert code-generated figures ----
// Matplotlib PNGs have hardcoded white backgrounds and dark text.
// invert(1) flips light/dark; hue-rotate(180deg) restores approximate hues.
// Only targets .cell-output-display images (code-generated), not content photos.
body.quarto-dark .cell-output-display .figure-img {
  filter: invert(1) hue-rotate(180deg);
}
